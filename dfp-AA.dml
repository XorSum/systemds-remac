# input: a,b
# output: x

#a = read("hdfs://127.0.0.1:9000/data/tmp/a3.csv",format="csv")
A = read("../data/a3.csv",format="csv")
#a = matrix("1 2 0 1 3 4 1 0 1 0 0 0 1 0 0 0 ",rows=4,cols=4)

#b = read("hdfs://10.11.1.198:9000/data/critieo/newb.bin",format="binary")
b = read("../data/b3.csv",format="csv")
#b = matrix("1 2 3 4",rows=4,cols=1)

c = read("../data/c3.csv",format="csv")

alpha = 0.00001

e = 1000  # 误差

rho = 0.8
sigma = 0.1

m = ncol(A)
n = nrow(A)


x = matrix(1,rows=m, cols=1)
#h = matrix(1, rows=m, cols=m)
h = diag(matrix(1,rows=m,cols=1))
#h = rand(rows=m, cols=m, min=0, max=1,  sparsity=0.999)

i = 1
end = FALSE
while((i<100)&(!end)) {
    g = 2 * (t(A) %*% A %*% x - c)
    loss = sum(t(g)%*%g)
    print("i="+toString(i)+"  loss="+toString(loss))
    i = i + 1
    if (loss > e) {
        d =  h %*% g
        x = x - alpha * d
        h = h - (h%*%t(A)%*%A%*%d%*%t(d)%*%t(A)%*%A%*%h)/(t(d)%*%t(A)%*%A%*%h%*%t(A)%*%A%*%d)  + (d%*%t(d))/(t(d)%*%t(A)%*%A%*%d*2)
   	} else {
        end = TRUE
    }
}

print("i=")
print(toString(i))

# write(x,"hdfs://10.11.1.198:9000/data/critieo/x.bin",format="binary")


